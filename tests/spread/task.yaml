summary: Test various emacs functionality
environment:
  CHANNEL/latest_stable: latest/stable
  CHANNEL/latest_candidate: latest/candidate
  CHANNEL/latest_beta: latest/beta
  CHANNEL/latest_edge: latest/edge

prepare: |
  snap install emacs --classic --channel $CHANNEL
  echo '(defun foo () (message "foo"))' >> test.el

restore: |
  rm -f test.el
  snap remove emacs
  rm -rf snap/emacs
  rm -rf .emacs.d

execute: |
  # test native compilation
  emacs --batch --eval '(native-compile "test.el")'

  # test treesit compilation
  emacs --batch --eval "(progn (require 'treesit) (add-to-list 'treesit-language-source-alist '(c . (\"https://github.com/tree-sitter/tree-sitter-c\"))) (treesit-install-language-grammar 'c))"
  test -f ~/.emacs.d/tree-sitter/libtree-sitter-c.so
